<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Arduino Calculator</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Matrix Rain Background */
#matrix-canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  background: #000;
}

body {
  display: flex;
  justify-content: center;
  align-items: center;
  background: transparent;
}

.calculator {
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(20px);
  border: 2px solid #00ff00;
  border-radius: 30px;
  padding: 25px;
  box-shadow: 0 0 50px rgba(0,255,0,0.5), 
              0 30px 80px rgba(0,0,0,0.9);
  width: 90vw;
  max-width: 420px;
  max-height: 95vh;
  display: flex;
  flex-direction: column;
  animation: slideIn 0.5s ease-out;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(30px) scale(0.9); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.header {
  text-align: center;
  color: #00ff00;
  margin-bottom: 20px;
  font-size: 24px;
  font-weight: bold;
  text-shadow: 0 0 10px #00ff00;
  letter-spacing: 2px;
}

.status-bar {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
  font-size: 12px;
  color: rgba(0,255,0,0.8);
}

.status {
  background: rgba(0,255,0,0.2);
  padding: 5px 12px;
  border-radius: 15px;
  font-weight: bold;
  border: 1px solid rgba(0,255,0,0.5);
}

.connected {
  background: rgba(0,255,0,0.4);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

.display-container {
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
  border-radius: 15px;
  margin-bottom: 20px;
  padding: 15px;
  box-shadow: inset 0 4px 15px rgba(0,0,0,0.8), 0 0 20px rgba(0,255,0,0.3);
  border: 2px solid #00ff00;
  min-height: 100px;
}

.expression {
  color: rgba(0,255,0,0.6);
  font-size: 18px;
  text-align: right;
  font-family: 'Courier New', monospace;
  margin-bottom: 10px;
  min-height: 25px;
}

.result {
  color: #00ff00;
  font-size: 36px;
  text-align: right;
  font-family: 'Courier New', monospace;
  font-weight: bold;
  text-shadow: 0 0 15px #00ff00;
}

.keypad {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  flex-grow: 1;
  margin-bottom: 15px;
}

button {
  border: 2px solid rgba(0,255,0,0.5);
  border-radius: 18px;
  cursor: pointer;
  transition: all 0.3s;
  color: #00ff00;
  font-size: 24px;
  font-weight: bold;
  background: rgba(0,0,0,0.6);
  box-shadow: 0 0 15px rgba(0,255,0,0.3);
  touch-action: manipulation;
  user-select: none;
}

button:active {
  transform: scale(0.92);
  box-shadow: 0 0 25px rgba(0,255,0,0.6);
}

button:hover {
  background: rgba(0,255,0,0.2);
  box-shadow: 0 0 30px rgba(0,255,0,0.5);
}

.num {
  background: rgba(0,100,0,0.3);
}

.op {
  background: rgba(0,150,0,0.3);
}

.eq {
  background: rgba(0,200,0,0.4);
  font-size: 28px;
}

.clear {
  background: rgba(255,50,0,0.4);
  color: #ff5500;
  border-color: rgba(255,50,0,0.5);
}

.connect-btn {
  background: rgba(0,255,0,0.3);
  border: 2px solid #00ff00;
  padding: 15px;
  width: 100%;
  font-size: 18px;
  border-radius: 15px;
  color: #00ff00;
  font-weight: bold;
  box-shadow: 0 0 20px rgba(0,255,0,0.4);
}

.keyboard-hint {
  text-align: center;
  color: rgba(0,255,0,0.6);
  font-size: 11px;
  margin-top: 8px;
  font-style: italic;
}
</style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>

<div class="calculator">
  <div class="header">‚ö°CALCULATOR‚ö°</div>
  
  <div class="status-bar">
    <div class="status" id="status">Not Connected</div>
    <div class="status">COA Project</div>
  </div>
  
  <div class="display-container">
    <div class="expression" id="expression"></div>
    <div class="result" id="result">0</div>
  </div>
  
  <div class="keypad">
    <button class="num" onclick="sendKey('7')">7</button>
    <button class="num" onclick="sendKey('8')">8</button>
    <button class="num" onclick="sendKey('9')">9</button>
    <button class="op" onclick="sendKey('D')">√∑</button>
    
    <button class="num" onclick="sendKey('4')">4</button>
    <button class="num" onclick="sendKey('5')">5</button>
    <button class="num" onclick="sendKey('6')">6</button>
    <button class="op" onclick="sendKey('C')">√ó</button>
    
    <button class="num" onclick="sendKey('1')">1</button>
    <button class="num" onclick="sendKey('2')">2</button>
    <button class="num" onclick="sendKey('3')">3</button>
    <button class="op" onclick="sendKey('B')">‚àí</button>
    
    <button class="clear" onclick="sendKey('*')">C</button>
    <button class="num" onclick="sendKey('0')">0</button>
    <button class="eq" onclick="sendKey('#')">=</button>
    <button class="op" onclick="sendKey('A')">+</button>
  </div>
  
  <button class="connect-btn" onclick="connect()">üîå Connect Arduino</button>
  <div class="keyboard-hint">üí° Keyboard: 0-9, +, -, *, /, =, C</div>
</div>

<script>
// Matrix Rain Animation
const canvas = document.getElementById('matrix-canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const chars = '01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥';
const fontSize = 16;
const columns = canvas.width / fontSize;
const drops = Array(Math.floor(columns)).fill(1);

function drawMatrix() {
  ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  ctx.fillStyle = '#0f0';
  ctx.font = fontSize + 'px monospace';
  
  for (let i = 0; i < drops.length; i++) {
    const text = chars[Math.floor(Math.random() * chars.length)];
    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
    
    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
      drops[i] = 0;
    }
    drops[i]++;
  }
}

setInterval(drawMatrix, 35);

window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

// Calculator Logic (same as before)
let port, writer, reader;
let keepReading = true;
let num1 = '', num2 = '', operator = '', currentNum = '';

const operatorSymbols = { 'A': '+', 'B': '‚àí', 'C': '√ó', 'D': '√∑' };

async function connect() {
  try {
    port = await navigator.serial.requestPort();
    await port.open({ baudRate: 9600 });
    writer = port.writable.getWriter();
    const textDecoder = new TextDecoderStream();
    port.readable.pipeTo(textDecoder.writable);
    reader = textDecoder.readable.getReader();
    
    document.getElementById('result').innerText = 'Connected!';
    document.getElementById('status').innerText = '‚úì Connected';
    document.getElementById('status').className = 'status connected';
    
    setTimeout(() => {
      document.getElementById('result').innerText = '0';
      readLoop();
    }, 1000);
  } catch(e) {
    alert('Connection failed: ' + e.message);
  }
}

async function sendKey(key) {
  if (!writer) {
    alert('‚ö†Ô∏è Please connect Arduino first!');
    return;
  }
  
  try {
    await writer.write(new TextEncoder().encode(key));
    
    if (key >= '0' && key <= '9') {
      currentNum += key;
      document.getElementById('result').innerText = currentNum;
    } else if (key === 'A' || key === 'B' || key === 'C' || key === 'D') {
      num1 = currentNum;
      operator = operatorSymbols[key];
      currentNum = '';
      document.getElementById('expression').innerText = num1 + ' ' + operator;
      document.getElementById('result').innerText = '';
    } else if (key === '#') {
      num2 = currentNum;
      document.getElementById('expression').innerText = num1 + ' ' + operator + ' ' + num2;
    } else if (key === '*') {
      num1 = ''; num2 = ''; operator = ''; currentNum = '';
      document.getElementById('expression').innerText = '';
      document.getElementById('result').innerText = '0';
    }
  } catch(e) {
    console.error('Send error:', e);
  }
}

async function readLoop() {
  try {
    while (keepReading) {
      const {value, done} = await reader.read();
      if (done) break;
      if (value) {
        const result = value.trim();
        if (result && result !== '0' && num1 && num2 && operator) {
          document.getElementById('expression').innerText = num1 + ' ' + operator + ' ' + num2 + ' =';
          document.getElementById('result').innerText = result;
          num1 = ''; num2 = ''; operator = ''; currentNum = result;
        } else if (result !== '') {
          document.getElementById('result').innerText = result;
        }
      }
    }
  } catch(e) {
    console.error('Read error:', e);
  }
}

document.addEventListener('keydown', (e) => {
  const key = e.key;
  if (key >= '0' && key <= '9') sendKey(key);
  else if (key === '+') sendKey('A');
  else if (key === '-') sendKey('B');
  else if (key === '*') sendKey('C');
  else if (key === '/') sendKey('D');
  else if (key === '=' || key === 'Enter') { e.preventDefault(); sendKey('#'); }
  else if (key === 'c' || key === 'C' || key === 'Escape') sendKey('*');
});

window.addEventListener('beforeunload', async () => {
  keepReading = false;
  if (reader) await reader.cancel();
  if (writer) await writer.releaseLock();
  if (port) await port.close();
});
</script>

</body>
</html>

